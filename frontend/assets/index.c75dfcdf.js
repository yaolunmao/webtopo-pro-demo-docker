import{a as w,r as l,$ as I,E as n,M as k,F as j,o as y,c as A,f as B,g as E,a2 as f}from"./index.14c307fc.js";import{g as N}from"./project.fbc60733.js";import{a as O}from"./style.59637bd2.js";import{s as r}from"./websocket.d7c5734e.js";const x={__name:"index",setup($){const m=w(),t=l("");t.value=m.query.project_id;const v=l(null),c=l(),d=l(),p=l(!0),_=(o,s,e,i,g)=>{if(console.log(o,s,e,i,22),o=="testRemoteControl"){f.success(`\u6536\u5230\u6307\u4EE4\uFF0C\u63A7\u5236${s}\u8BBE\u5907,\u9644\u52A0\u6D88\u606F\u662F${g}`);const a={projectId:t.value,deviceId:e,props:[{type:"onOff",val:!i.state.OnOff.default}]};r(a)}else o=="testAllOpen"?e.forEach(a=>{const u={projectId:t.value,deviceId:a,props:[{type:i,val:!0}]};r(u)}):o=="testAllClose"?e.forEach(a=>{const u={projectId:t.value,deviceId:a,props:[{type:i,val:!1}]};r(u)}):f.error(`\u672A\u89E3\u6790\u7684\u6307\u4EE4:${o}`)};return N(t.value).then(o=>{v.value=JSON.parse(o.data.dataModel),p.value=!1,c.value=new WebSocket(`ws://127.0.0.1:8888/ws/${I()}`),c.value.onopen=function(s){console.log("websocket\u8FDE\u63A5\u6210\u529F");const e={projectId:t.value,deviceId:11,props:[{type:"ws_state",val:!0}]};r(e)},c.value.onmessage=function(s){const e=JSON.parse(s.data);console.log("websocket\u6536\u5230\u6D88\u606F",e),e.type=="setNodeAttr"?d.value.setNodeAttr(e.msg):e.type=="setNodeAttrByID"?d.value.setNodeAttrByID(e.msg):console.log("\u672A\u5B9A\u4E49\u7684\u6570\u636E\u7C7B\u578B")},c.value.onclose=function(s){console.log("\u8FDE\u63A5\u5DF2\u65AD\u5F00");const e={projectId:t.value,deviceId:11,props:[{type:"ws_state",val:!1}]};r(e)}}),t.value==1?(n({title:"\u8BBE\u5907\u6A21\u62DF",dangerouslyUseHTMLString:!0,message:`<div>\u8BF7\u70B9\u51FB<a href="/ws_power_system?project_id=${t.value}" target="_blank"><strong>\u8FD9\u91CC</strong></a>\u8FDB\u884C\u8BBE\u5907\u6A21\u62DF</div>`,duration:0}),setTimeout(()=>{n({title:"\u60AC\u6D6E\u529F\u80FD",message:"A\u724C\u65AD\u8DEF\u5668\u914D\u7F6E\u4E86\u60AC\u6D6E\u5C55\u793A,\u8BF7\u628A\u9F20\u6807\u653E\u5230\u56FE\u7EB8\u4E0A\u7684A\u724C\u65AD\u8DEF\u5668\u4E0A\u67E5\u770B",duration:0})},100),setTimeout(()=>{n({title:"\u8BBE\u5907\u63A7\u5236",message:"B\u724C\u65AD\u8DEF\u5668\u914D\u7F6E\u4E86\u70B9\u51FB\u4E8B\u4EF6,\u8BF7\u70B9\u51FB\u56FE\u7EB8\u4E0A\u7684B\u724C\u65AD\u8DEF\u5668\u67E5\u770B",duration:0})},100),setTimeout(()=>{n({title:"\u7535\u6D41\u4E0E\u65AD\u8DEF\u5668\u540C\u6B65",message:"\u5728\u8BBE\u5907\u6A21\u62DF\u9875\u5F00\u542F\u5173\u95ED\u65AD\u8DEF\u5668\uFF0C\u89C2\u5BDF\u7535\u6D41\u52A8\u753B",duration:0})},100)):n({title:"\u529F\u80FD\u5F00\u53D1\u4E2D\u656C\u8BF7\u671F\u5F85",message:"\u672C\u9875\u7684\u5B9E\u65F6\u6570\u636E\u6682\u672A\u63A5\u5165\uFF0C\u5982\u9700\u67E5\u770B\u6F14\u793A\u8BF7\u79FB\u6B65\u7535\u529B\u7CFB\u7EDF\u9879\u76EE\u6F14\u793A",duration:0}),(o,s)=>{const e=k("loading");return j((y(),A("div",null,[B(E(O),{ref_key:"svgPreviewRef",ref:d,"data-model":v.value,"canvas-drag":!0,onOnEventCallBack:_},null,8,["data-model"])])),[[e,p.value]])}}};export{x as default};
